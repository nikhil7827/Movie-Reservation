{% extends "base.html" %}
{% block title %}Showtimes - {{ movie.title }}{% endblock %}
{% block content %}
    <h2>Showtimes for {{ movie.title }}</h2>
    <ul class="list-group">
        {% for showtime in showtimes %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    {{ showtime.showtime.strftime('%Y-%m-%d %H:%M') }}<br>
                    <small>Available Seats: {{ showtime.total_seats - showtime.reserved_seats }}</small>
                </div>
                {% if current_user.is_authenticated %}
                    <form method="POST" action="{{ url_for('reservation.reserve_seat', showtime_id=showtime.id) }}" class="d-inline">
                        <input type="number" name="seat_count" min="1" max="{{ showtime.total_seats - showtime.reserved_seats }}" value="1" class="form-control d-inline w-auto">
                        <button type="submit" class="btn btn-primary btn-sm">Reserve</button>
                    </form>
                {% endif %}
                {% if current_user.is_authenticated and current_user.role == 'admin' %}
                    <form method="POST" action="{{ url_for('movie.delete_showtime', showtime_id=showtime.id) }}" class="d-inline">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <h3 class="mt-4">Add Showtime</h3>
        <form method="POST" action="{{ url_for('movie.add_showtime', movie_id=movie.id) }}">
            <div class="mb-3">
                <label for="showtime" class="form-label">Showtime (YYYY-MM-DD HH:MM)</label>
                <input type="datetime-local" class="form-control" id="showtime" name="showtime" required>
            </div>
            <div class="mb-3">
                <label for="total_seats" class="form-label">Total Seats</label>
                <input type="number" class="form-control" id="total_seats" name="total_seats" value="100" required>
            </div>
            <button type="submit" class="btn btn-success">Add Showtime</button>
        </form>
    {% endif %}
{% endblock %}